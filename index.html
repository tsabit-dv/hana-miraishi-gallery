<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>For Hana</title>
<style>
html,body{
    margin:0;
    width:100%;
    height:100%;
    overflow:hidden;
    background:radial-gradient(circle at center,#1a1a1a,#000);
    font-family:"Segoe Script",cursive;
}
#scene{
    position:fixed;
    inset:0;
}
canvas{
    position:absolute;
    inset:0;
    pointer-events:none;
}
#ui{
    position:absolute;
    inset:0;
    pointer-events:none;
}
button{
    pointer-events:auto;
    cursor:pointer;
    border-radius:999px;
    padding:14px 44px;
    font-size:18px;
    font-weight:600;
    color:#ff7aa2;
    background:rgba(255,122,162,.18);
    backdrop-filter:blur(14px);
    border:1px solid rgba(255,122,162,.35);
    box-shadow:
        0 8px 30px rgba(255,122,162,.35),
        inset 0 0 18px rgba(255,255,255,.15);
    transition:.35s;
}
button:hover{
    transform:translateY(-2px) scale(1.03);
    box-shadow:
        0 12px 40px rgba(255,122,162,.55),
        inset 0 0 22px rgba(255,255,255,.2);
}
#galleryBtn{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    opacity:0;
    pointer-events:none;
}
#carousel{
    position:absolute;
    inset:0;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    background:rgba(0,0,0,.85);
    opacity:0;
    pointer-events:none;
    transition:.8s;
}
.carousel-box{
    width:70%;
    max-width:720px;
    height:400px;
    border-radius:24px;
    background:#111;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
    box-shadow:0 25px 50px rgba(0,0,0,.45);
}
.carousel-box img{
    width:100%;
    height:100%;
    object-fit:contain;
    transition:opacity .5s ease;
}
#backBtn{
    margin-top:34px;
}
.show{
    opacity:1!important;
    pointer-events:auto!important;
}
</style>
</head>
<body>

<div id="scene">
    <canvas id="canvas"></canvas>
</div>

<div id="ui">
    <button id="galleryBtn">Gallery</button>
</div>

<div id="carousel">
    <div class="carousel-box">
        <img id="carouselImg" src="img1.jpeg">
    </div>
    <button id="backBtn">Back</button>
</div>

<audio id="bgm" src="audio.mp3" loop></audio>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const galleryBtn=document.getElementById("galleryBtn");
const carousel=document.getElementById("carousel");
const backBtn=document.getElementById("backBtn");
const audio=document.getElementById("bgm");
const img=document.getElementById("carouselImg");

function resize(){
    canvas.width=innerWidth;
    canvas.height=innerHeight;
    ctx.setTransform(1,0,0,1,canvas.width/2,canvas.height/2);
}
resize();
addEventListener("resize",resize);

const STATE={DRAW:0,FILL:1,TEXT:2,SPARKLE:3,IDLE:4,GALLERY:5};
let state=STATE.DRAW;

let points=[],i=0,fill=0,textA=0,heartAlpha=1,sparkleAlpha=0;

for(let t=0;t<=Math.PI*2;t+=0.02){
    let x=16*Math.sin(t)**3;
    let y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
    points.push({x:x*12,y:-y*12});
}

const bounds={
    minY:Math.min(...points.map(p=>p.y)),
    maxY:Math.max(...points.map(p=>p.y))
};

let stars=[...Array(220)].map(()=>({
    x:Math.random()*canvas.width-canvas.width/2,
    y:Math.random()*canvas.height-canvas.height/2,
    r:Math.random()*1.5+0.5,
    a:Math.random(),
    s:Math.random()*0.015+0.005
}));

const photos=["img1.jpeg","img2.jpeg","img3.jpeg"];
let pIndex=0;

setInterval(()=>{
    if(state!==STATE.GALLERY) return;
    pIndex=(pIndex+1)%photos.length;
    img.style.opacity=0;
    setTimeout(()=>{
        img.src=photos[pIndex];
        img.style.opacity=1;
    },300);
},3000);

const ease=t=>1-Math.pow(1-t,3);

function draw(){
    ctx.clearRect(-canvas.width/2,-canvas.height/2,canvas.width,canvas.height);

    if(state>=STATE.SPARKLE){
        sparkleAlpha=Math.min(sparkleAlpha+0.01,1);
        ctx.globalAlpha=sparkleAlpha;
        ctx.fillStyle="#fff";
        stars.forEach(s=>{
            ctx.beginPath();
            ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
            ctx.fill();
            s.a+=s.s;
            if(s.a>1)s.a=0;
        });
        ctx.globalAlpha=1;
    }

    ctx.globalAlpha=heartAlpha;

    if(fill>0){
        const f=ease(fill);
        ctx.save();
        ctx.beginPath();
        points.forEach((p,j)=>j?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));
        ctx.closePath();
        ctx.clip();

        const h=bounds.maxY-bounds.minY;
        ctx.fillStyle="#ff7aa2";
        ctx.fillRect(-200,bounds.maxY-h*f,400,h*f);
        ctx.restore();
    }

    ctx.fillStyle="#ff4d6d";
    for(let j=0;j<i;j++){
        ctx.beginPath();
        ctx.arc(points[j].x,points[j].y,2.5,0,Math.PI*2);
        ctx.fill();
    }

    if(state>=STATE.TEXT){
        ctx.globalAlpha=textA*heartAlpha;
        ctx.font="52px cursive";
        ctx.fillStyle="#fff";
        ctx.textAlign="center";
        ctx.fillText("hana",0,25);
    }

    ctx.globalAlpha=1;

    if(state===STATE.DRAW && i<points.length) i++;
    else if(state===STATE.DRAW) state=STATE.FILL;

    if(state===STATE.FILL && fill<1) fill+=0.012;
    else if(state===STATE.FILL) state=STATE.TEXT;

    if(state===STATE.TEXT && textA<1) textA+=0.02;
    else if(state===STATE.TEXT) state=STATE.SPARKLE;

    if(state===STATE.SPARKLE){
        galleryBtn.style.top=(canvas.height/2 + bounds.maxY + 40)+"px";
        galleryBtn.classList.add("show");
        state=STATE.IDLE;
    }

    requestAnimationFrame(draw);
}
draw();

galleryBtn.onclick=()=>{
    audio.play();
    let f=setInterval(()=>{
        heartAlpha-=0.05;
        if(heartAlpha<=0){
            clearInterval(f);
            carousel.classList.add("show");
            state=STATE.GALLERY;
        }
    },30);
};

backBtn.onclick=()=>{
    carousel.classList.remove("show");
    let f=setInterval(()=>{
        heartAlpha+=0.05;
        if(heartAlpha>=1){
            clearInterval(f);
            state=STATE.IDLE;
        }
    },30);
};
</script>

</body>
</html>
